<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Knitting Graph Paper Generator</title>
</head>
<body>
<div class="header">
  <h2>Create Graph Paper for Knitters</h2>
  <p>When you need to graph a pattern for knitting, it is really helpful if
    the graph paper grid corresponds with the knitting stitch size. This web application can help
    you to create some graph paper that matches your knitting. If you have not used this
    web application before then please read the help below.
  </p>
  <button onclick="toggleHelp(this)">Show Help</button>
  <div class="hide-help" id="help">
    <h2>1. Create the test swatch</h2>

    <p>The first thing to do is to knit a small swatch (sometimes called a tension square)
      using the yarn and needles which you intend to use for the main garment. That's
      right, a test swatch, an often-overlooked requirement!
    </p>
    <ol>
      <li>Cast on enough stitches to make at least 15 cm width of knitting.
        The exact number does not really matter.
      </li>
      <li>Now knit enough rows to make at least 15 cm of fabric.</li>
      <li>Cast off. Your test swatch is completed but not blocked.</li>
    </ol>

    <h2>2. Block the test swatch</h2>

    <p>Blocking is the term given to pressing or otherwise setting your work to prevent it
      from distorting. Depending on your material, blocking can be a simple process.
      Here is one method which works with Marlyn Alpaca and most natural fibres:
    </p>

    <ol>
      <li>Pin the test swatch to an ironing board, ensuring that it is square and not distorted.</li>
      <li>Spray lightly with water.</li>
      <li>Leave it to dry (could be overnight).</li>
      <li>When it is dry, your test swatch is blocked and should be stable.</li>
    </ol>

    <p>It is a good idea to label your test swatch with details of the yarn,
      needle size (hand knit) or tension settings (machine knit).
    </p>

    <h2>3. Measure the test swatch</h2>

    <p>Measuring the number of stitches per 10 cm of fabric gives you a good
      idea as to how many stitches and rows you will need for your garment.
    </p>

    <ol>
      <li>Using a flat rule, place it across the test swatch so you can see a 10 cm
        portion in the middle of the knitting. Make sure the knitting is not stretched
        or distorted. Write down how many <b>stitches</b> you can count in the 10 cm portion.
        Near enough is OK.
      </li>
      <li>Rotate the rule now so it is going down the work, and count how many <b>rows</b>
        you see in a 10 cm portion of the middle of the work. Again near enough is OK.
      </li>
    </ol>

    <h2>4. Now make your graph paper</h2>

    <p>Now that you have the number of stitches and rows for a 10 cm portion of
      knitted fabric, we can insert those values into the form above and generate a
      sheet of graph paper which has been customised for your fabric.
    </p>

    <p>There are some additional options that you may find useful such as sheet
      size (A4 or A3 portrait), whether you want a darker line every 10 stitches and rows,
      and whether you want the graph paper as a printable PDF file or whether
      you intend to do something else with it such as edit your picture onto it,
      which will be an SVG file.
    </p>

  </div>
</div>
<div class="controls">
  <p><b>Settings that change the graph size</b>:</p>
  <div class="control-inter not-implemented">
    <label>Stitch count: <input type="number" min="1" value="10" disabled/></label> and
    <label>Row count: <input type="number" min="1" value="10" disabled/> </label>
    from measuring your tension square (not implemented)
  </div>
  <div class="control-inter">
    <label>Graph width: <input type="number" value="212" id="width"/>mm</label>
    <label>Graph height: <input type="number" value="297" id="height"/>mm</label>
  </div>
</div>
<div class="controls">
  <p><b>Settings that change the graph appearance (see sample below)</b>:</p>
  <div class="control-inter">
    <label>Major grid lines:
      <label>Stroke Width
        <input class="inputMaxGrid" type="number" value="2" min="0" onchange="grid({strokeWidth:this.value})"/>
      </label>
      <label> Size
        <input class="inputMaxGrid" type="number" value="80" min="0"
               onchange="grid({gridDimWidth:this.value})"/>
      </label>
      <label>Color
        <input class="gridColor" value="#000000" type="color" onchange="grid({color:this.value})"/>
      </label>
    </label>
  </div>
  <div class="control-inter">
    <label>Minor grid lines:
      <label>Stroke Width
        <input class="inputMaxGrid" type="number" value="2" min="0" onchange="smallGrid({strokeWidth:this.value})"/>
      </label>
      <label>Size
        <input class="inputMaxSmallGrid" type="number" value="8" min="0"
               onchange="smallGrid({gridDimWidth:this.value})"/>
      </label>
      <label>Color
        <input class="smallGridColor" value="#000000" type="color" onchange="smallGrid({color:this.value})"/>
      </label>
    </label>
  </div>
</div>
</div>
<div class="controls">
  <button onclick="resize()">Resize</button>
  <button onclick="generateSVG()">Generate SVG</button>
  <a style="display: none;" id="link" href="" download="pattern.svg">Download SVG</a>
</div>
<div>
  <p>Sample</p>
  <div class="view">
    <svg id="svg" width="212mm" height="297mm"
         xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="smallGrid" width="8" height="8" fill="white" patternUnits="userSpaceOnUse">
          <rect id="smalRect" width="80" height="80" fill="url(#smallGrid)"></rect>
          <path id="smallPath" d="M 8 0 L 0 0 0 8" fill="none" stroke="gray" stroke-width="0.5"></path>
        </pattern>
        <pattern id="grid" width="80" height="80" fill="white" patternUnits="userSpaceOnUse">
          <rect id="rect" width="80" height="80" fill="url(#smallGrid)"></rect>
          <path id="gridPath" d="M 80 0 L 0 0 0 80" fill="none" stroke="gray" stroke-width="2"></path>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)"></rect>
    </svg>
  </div>
</div>
<div class="footer">
  <p>Tested with Google Chrome version 60</p>
</div>
<script>

  function toggleHelp(o) {
    const help = document.getElementById('help');
    if (help.className === 'show-help') {
      help.className = 'hide-help';
      o.innerHTML = 'Show Help';
    } else {
      help.className = 'show-help';
      o.innerHTML = 'Hide Help';
    }
  }

  function grid(o) {
    //grid
    const grid = document.getElementById('grid');
    const gridDim = {width: grid.getAttribute('width'), height: grid.getAttribute('height')};
    grid.setAttribute('width', o.gridDimWidth || gridDim.width);
    grid.setAttribute('height', o.gridDimWidth || gridDim.height);
    //gridPath
    const path = document.getElementById('gridPath');
    const d = path.getAttribute('d');
    const ds = d.split(/\s/);
    let s = o.A || o.F || o.gridDimWidth || o.gridDimWidth || o.rectDimWidth;
    const newD = `M ${s || ds[1]} ${o.B || ds[2]} L ${o.C || ds[4]} ${o.D || ds[5]} ${o.E || ds[6]} ${s || ds[7]}`;
    path.setAttribute('d', newD);
    //stroke-width
    const strokeWidth = path.getAttribute('stroke-width');
    path.setAttribute('stroke-width', o.strokeWidth || strokeWidth);
    //color
    const strokeColor = path.getAttribute('stroke');
    path.setAttribute('stroke', o.color || strokeColor);
    //rect
    const rect = document.getElementById('rect');
    const rectDim = {width: rect.getAttribute('width'), height: rect.getAttribute('height')};
    rect.setAttribute('width', o.gridDimWidth || rectDim.width);
    rect.setAttribute('height', o.gridDimWidth || rectDim.height);
  }

  function smallGrid(o) {
    //smallPath
    const path = document.getElementById('smallPath');
    const d = path.getAttribute('d');
    const ds = d.split(/\s/);
    let s = o.A || o.F || o.gridDimWidth;
    const newD = `M ${s || ds[1]} ${o.B || ds[2]} L ${o.C || ds[4]} ${o.D || ds[5]} ${o.E || ds[6]} ${s || ds[7]}`;
    path.setAttribute('d', newD);
    //stroke-width
    const strokeWidth = path.getAttribute('stroke-width');
    path.setAttribute('stroke-width', o.strokeWidth || strokeWidth);
    //color
    const strokeColor = path.getAttribute('stroke');
    path.setAttribute('stroke', o.color || strokeColor);
    //rect
    const rect = document.getElementById('smalRect');
    const rectDim = {width: rect.getAttribute('width'), height: rect.getAttribute('height')};
    rect.setAttribute('width', o.rectDimWidth || rectDim.width);
    rect.setAttribute('height', o.rectDimWidth || rectDim.height);
    //smallGrid
    const grid = document.getElementById('smallGrid');
    const gridDim = {width: grid.getAttribute('width'), height: grid.getAttribute('height')};
    grid.setAttribute('width', o.gridDimWidth || gridDim.width);
    grid.setAttribute('height', o.gridDimWidth || gridDim.height);
  }


  function resize() {
    const svg = document.getElementById('svg');
    const width = document.getElementById('width');
    const height = document.getElementById('height');
    svg.setAttribute('width', width.value + 'mm');
    svg.setAttribute('height', height.value + 'mm');
  }

  function generateSVG() {
    //get svg element.
    const svg = document.getElementById("svg");

    //get svg source.
    const serializer = new XMLSerializer();
    let source = serializer.serializeToString(svg);

    //add name spaces.
    if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
      source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
    }
    if (!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
      source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
    }

    //add xml declaration
    source = '<?xml version="1.0" standalone="no"?>\r\n' + source;

    //convert svg source to URI data scheme.
    const url = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(source);

    //set url value to a element's href attribute.
    document.getElementById("link").href = url;
    document.getElementById("link").style = "display:inline;"
    //you can download svg file by right click menu.
  }
</script>
<style>
  html, body {
    height: 100%;
  }

  body {
    margin: 20px;
    background-color: #FFF8F0;
  }

  input[type="number"] {
    width: 60px
  }

  .center {
    display: inline-block;
  }

  .header {
  }

  .show-help {
    display: block;
    margin-left: 30px;
    margin-bottom: 20px;
  }

  .hide-help {
    display: none;
    margin-left: 30px;
    margin-bottom: 20px;
  }

  .controls {
    padding-top: 10px;
    padding-bottom: 10px;
  }

  .control-inter {
    padding: 0.2em;
  }

  .footer {
    padding-top: 20px;
    padding-bottom: 20px;
  }

  .not-implemented {
    display: block;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.1);
    z-index: 2;
    color: gray;
  }

</style>
</body>
</html>
