<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grid Generator</title>
</head>
<body>
<div class="center">
  <div class="header">
    <h2>Knit with Grids!</h2>
  </div>
  <div class="controls-top">
    <label class="label">Grid<br/>
      <label>Stroke Width
        <input class="inputMaxGrid" type="number" value="2" min="0" onchange="grid({strokeWidth:this.value})"/>
      </label>
      <label> Size
        <input class="inputMaxGrid" type="number" value="80" min="0"
               onchange="grid({gridDimWidth:this.value})"/>
      </label>
      <label>Color
        <input class="gridColor" value="#000000" type="color" onchange="grid({color:this.value})"/>
      </label>
    </label>
    <label class="label">Small Grid<br/>
      <label>Stroke Width
        <input class="inputMaxGrid" type="number" value="2" min="0" onchange="smallGrid({strokeWidth:this.value})"/>
      </label>
      <label>Size
        <input class="inputMaxSmallGrid" type="number" value="8" min="0"
               onchange="smallGrid({gridDimWidth:this.value})"/>
      </label>
      <label>Color
        <input class="smallGridColor" value="#000000" type="color" onchange="smallGrid({color:this.value})"/>
      </label>
    </label>
  </div>
  <div class="controls">
    <label>SVG<br/>
      <label>Width: <input type="number" value="300" id="width"/>mm</label>
      <label>Height: <input type="number" value="400" id="height"/>mm</label>
      <button onclick="resize()">Resize</button>
      <button onclick="generateSVG()">Generate</button>
      <a style="display: none;" id="link" href="" download="pattern.svg">Download</a>
    </label>
  </div>
  <div class="sample">
    <p>Sample</p>
    <div class="view">
      <svg id="svg" width="100%" height="100%"
           xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="smallGrid" width="8" height="8" fill="white" patternUnits="userSpaceOnUse">
            <rect id="smalRect" width="80" height="80" fill="url(#smallGrid)"></rect>
            <path id="smallPath" d="M 8 0 L 0 0 0 8" fill="none" stroke="gray" stroke-width="0.5"></path>
          </pattern>
          <pattern id="grid" width="80" height="80" fill="white" patternUnits="userSpaceOnUse">
            <rect id="rect" width="80" height="80" fill="url(#smallGrid)"></rect>
            <path id="gridPath" d="M 80 0 L 0 0 0 80" fill="none" stroke="gray" stroke-width="2"></path>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)"></rect>
      </svg>
    </div>
  </div>
  <div class="footer">
    <p>Tested with Google Chrome version 60</p>
  </div>
</div>
<script>

  function grid(o) {

    //grid
    const grid = document.getElementById('grid');
    const gridDim = {width: grid.getAttribute('width'), height: grid.getAttribute('height')};
    grid.setAttribute('width', o.gridDimWidth || gridDim.width);
    grid.setAttribute('height', o.gridDimWidth || gridDim.height);
    //gridPath
    const path = document.getElementById('gridPath');
    const d = path.getAttribute('d');
    const ds = d.split(/\s/);
    let s = o.A || o.F || o.gridDimWidth || o.gridDimWidth || o.rectDimWidth;
    const newD = `M ${s || ds[1]} ${o.B || ds[2]} L ${o.C || ds[4]} ${o.D || ds[5]} ${o.E || ds[6]} ${s || ds[7]}`;
    path.setAttribute('d', newD);
    //stroke-width
    const strokeWidth = path.getAttribute('stroke-width');
    path.setAttribute('stroke-width', o.strokeWidth || strokeWidth);
    //color
    const strokeColor = path.getAttribute('stroke');
    path.setAttribute('stroke', o.color || strokeColor);
    //rect
    const rect = document.getElementById('rect');
    const rectDim = {width: rect.getAttribute('width'), height: rect.getAttribute('height')};
    rect.setAttribute('width', o.gridDimWidth || rectDim.width);
    rect.setAttribute('height', o.gridDimWidth || rectDim.height);
  }

  function smallGrid(o) {
    //smallPath
    const path = document.getElementById('smallPath');
    const d = path.getAttribute('d');
    const ds = d.split(/\s/);
    let s = o.A || o.F || o.gridDimWidth;
    const newD = `M ${s || ds[1]} ${o.B || ds[2]} L ${o.C || ds[4]} ${o.D || ds[5]} ${o.E || ds[6]} ${s || ds[7]}`;
    path.setAttribute('d', newD);
    //stroke-width
    const strokeWidth = path.getAttribute('stroke-width');
    path.setAttribute('stroke-width', o.strokeWidth || strokeWidth);
    //color
    const strokeColor = path.getAttribute('stroke');
    path.setAttribute('stroke', o.color || strokeColor);
    //rect
    const rect = document.getElementById('smalRect');
    const rectDim = {width: rect.getAttribute('width'), height: rect.getAttribute('height')};
    rect.setAttribute('width', o.rectDimWidth || rectDim.width);
    rect.setAttribute('height', o.rectDimWidth || rectDim.height);
    //smallGrid
    const grid = document.getElementById('smallGrid');
    const gridDim = {width: grid.getAttribute('width'), height: grid.getAttribute('height')};
    grid.setAttribute('width', o.gridDimWidth || gridDim.width);
    grid.setAttribute('height', o.gridDimWidth || gridDim.height);
  }


  function resize() {
    const svg = document.getElementById('svg');
    const width = document.getElementById('width');
    const height = document.getElementById('height');
    svg.setAttribute('width', width.value + 'mm');
    svg.setAttribute('height', height.value + 'mm');
  }

  function generateSVG() {
    //get svg element.
    const svg = document.getElementById("svg");

    //get svg source.
    const serializer = new XMLSerializer();
    let source = serializer.serializeToString(svg);

    //add name spaces.
    if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
      source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
    }
    if (!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
      source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
    }

    //add xml declaration
    source = '<?xml version="1.0" standalone="no"?>\r\n' + source;

    //convert svg source to URI data scheme.
    const url = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(source);

    //set url value to a element's href attribute.
    document.getElementById("link").href = url;
    document.getElementById("link").style = "display:inline;"
    //you can download svg file by right click menu.
  }
</script>
<style>
  html, body {
    height: 100%;
  }

  body {
    margin: 0;
    text-align: center;
  }

  .center {
    display: inline-block;
  }

  .label {
    display: block;
    border-bottom: solid 1px cadetblue;
    padding: 10px;
  }

  .header {
  }

  .controls-top {
    padding-top: 10px;
    padding-bottom: 10px;
  }

  .controls {
    border-bottom: solid 1px cadetblue;
    padding-top: 10px;
    padding-bottom: 10px;
  }

  .sample {
    max-width: 640px;
    max-height: 480px;
  }

  .view {
    width: 640px;
    height: 480px;
    overflow: auto;
  }

  .footer {
    padding-top: 20px;
    padding-bottom: 20px;
  }

</style>
</body>
</html>
